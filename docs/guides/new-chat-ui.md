# 新版聊天 UI 使用指南

## 界面预览

新版 AI 聊天界面采用了现代化的设计，参考了 Roo-Code 的优秀 UI 设计，提供更专业、更直观的用户体验。

## 主要功能

### 1. 消息展示

#### 用户消息
- 🔵 蓝色图标标识
- 显示 "你" 作为角色名
- 支持 Markdown 格式
- 代码自动高亮

#### AI 消息
- 🟢 绿色机器人图标
- 显示 "AI 助手" 作为角色名
- 包含时间戳
- 流式输出效果

### 2. 工具调用

当 AI 需要执行工具（如 SSH 命令）时，会显示专门的工具卡片：

```
┌─────────────────────────────────────┐
│ 🖥️ SSH 命令执行                     │
├─────────────────────────────────────┤
│ command: pwd                        │
├─────────────────────────────────────┤
│ ✅ 执行成功                          │
│ /home/user                          │
└─────────────────────────────────────┘
```

#### 工具类型图标

- 🖥️ **SSH 命令执行**（execute_ssh_command）
- 📄 **文件读取**（read_file）
- 📁 **目录列表**（list_files）
- 🔧 **其他工具**

### 3. 工具批准

当 AI 请求执行工具时，会弹出批准对话框：

- **查看详情**：工具名称、参数、说明
- **安全警告**：潜在危险命令会高亮显示
- **提供反馈**：可以修改命令或添加额外指示
- **批准/拒绝**：用户完全控制工具执行

### 4. 消息输入

#### 多行输入框
- 支持多行文本输入
- 自动高度调整
- 语法高亮（如果是代码）

#### 快捷键
- **Ctrl+Enter**（Windows/Linux）或 **⌘+Enter**（Mac）：发送消息
- **Shift+Enter**：换行

#### 发送按钮
- 输入内容后按钮激活
- AI 生成中显示 "生成中..." 状态
- 可以随时停止生成

## 视觉元素

### 状态指示器

#### 加载动画
```
⚫ ⚫ ⚫  (跳动的点)
```

#### 工具执行进度
```
🔄 Executing command: ls -la
```

#### 执行结果状态
- ✅ **成功**：绿色背景
- ❌ **失败**：红色背景

### 代码块

代码会自动高亮显示：

````markdown
```python
def hello():
    print("Hello, World!")
```
````

效果：
```python
def hello():
    print("Hello, World!")
```

### 行内代码

使用反引号包裹的代码会有特殊样式：`npm install`

## 使用技巧

### 1. 高效输入

**问题**：
```
执行 pwd 命令
```

**AI 响应**：
- 解析意图
- 调用 SSH 命令工具
- 显示执行结果
- 继续对话

### 2. 复杂任务

**问题**：
```
帮我检查服务器上 /var/log/nginx 目录下最近的错误日志
```

**AI 流程**：
1. 列出目录文件
2. 找到最新的错误日志
3. 读取日志内容
4. 分析并总结问题

### 3. 多步骤操作

AI 会自动执行多个工具调用来完成复杂任务：

```
用户: 在服务器上创建一个 Python 虚拟环境

AI: 
  1. 检查当前目录 (pwd)
  2. 创建虚拟环境 (python3 -m venv venv)
  3. 验证创建成功 (ls -la)
  4. 提示激活命令
```

## 自定义配置

### Props 配置

```vue
<AIChatSessionWithTools
  :current-provider="provider"
  :current-model="model"
  :connection-id="sshId"
  :enable-tools="true"
  :multiline="true"
  :input-rows="3"
  input-placeholder="自定义占位符"
  empty-state-text="自定义空状态文本"
  max-height="500px"
  @tool-executed="handleToolExecuted"
/>
```

### 样式自定义

组件使用 VSCode 主题变量，会自动适配你的编辑器主题：

- 亮色主题 → 亮色聊天界面
- 暗色主题 → 暗色聊天界面

## 常见问题

### Q: 如何停止 AI 生成？

A: 点击发送按钮（此时显示为 "生成中..."）即可停止。

### Q: 工具执行失败怎么办？

A: 
1. 查看错误消息
2. 检查 SSH 连接状态
3. 确认命令权限
4. 重新描述问题，AI 会尝试其他方法

### Q: 如何查看历史消息？

A: 所有消息都保留在界面中，可以向上滚动查看。

### Q: 代码没有高亮？

A: 确保代码块使用正确的语法：

````markdown
```语言名
代码内容
```
````

### Q: 消息太长怎么办？

A: 消息区域会自动滚动，可以通过鼠标滚轮或滚动条浏览。

## 最佳实践

### 1. 清晰的问题描述

✅ **好的问题**：
```
执行 ls -la 命令查看当前目录的详细文件列表
```

❌ **不好的问题**：
```
ls
```

### 2. 上下文信息

✅ **有上下文**：
```
我刚才看到 /var/log 目录，现在想查看里面的 syslog 文件的最后 50 行
```

❌ **缺乏上下文**：
```
查看 syslog
```

### 3. 分步确认

对于重要操作，可以分步进行：

```
1. 先列出要删除的文件
2. 确认文件列表
3. 再执行删除命令
```

## 键盘快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+Enter` | 发送消息 |
| `Shift+Enter` | 换行 |
| `Esc` | 取消工具批准对话框 |
| `F12` | 打开开发者工具（调试用） |

## 性能建议

- 保持消息数量在合理范围（< 100 条）
- 大量代码输出建议保存到文件
- 定期清空历史消息（未实现）
- 关闭不需要的工具功能

## 反馈和支持

如果遇到问题或有改进建议，请：

1. 按 F12 打开开发者工具
2. 查看控制台日志
3. 记录错误信息
4. 提交 Issue 或反馈

---

**提示**：新版 UI 还在持续改进中，欢迎提供使用反馈！


