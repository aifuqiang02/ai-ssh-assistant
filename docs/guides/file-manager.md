# SSH 文件管理功能使用指南

## 功能概述

已成功实现在连接列表中右键打开文件管理功能，支持批量上传和批量下载。文件管理器以标签页形式打开，可以同时打开多个连接的文件管理器。

## 功能特性

### 1. 打开文件管理器
- 在连接列表中，右键点击任意SSH连接
- 选择"文件管理"选项
- 系统会自动建立SSH连接并在新标签页中打开文件管理器
- 可以同时打开多个连接的文件管理器标签页

### 2. 文件浏览
- 支持浏览远程服务器的文件和目录
- 显示文件大小、修改时间等详细信息
- 双击目录可进入子目录
- 点击返回按钮或主目录按钮快速导航

### 3. 批量上传
- 点击"上传文件"按钮
- 可多选本地文件
- 自动上传到当前远程目录
- 显示上传进度

### 4. 批量下载
- 勾选多个远程文件
- 点击"批量下载"按钮
- 选择本地保存目录
- 自动下载所有选中文件

### 5. 其他操作
- **新建文件夹**：在远程服务器创建新目录
- **删除文件**：删除单个或批量删除文件/目录
- **刷新**：重新加载当前目录的文件列表

## 技术实现

### 修改的文件：

1. **apps/desktop/src/components/ssh/SSHTreeNode.vue**
   - 添加"文件管理"菜单项
   - 添加 `open-file-manager` 事件

2. **apps/desktop/src/views/FileManagerView.vue** (新建)
   - 完整的文件管理器视图（标签页模式）
   - 支持批量操作
   - 文件上传下载进度显示
   - 类似TerminalView的实现方式

3. **apps/desktop/src/components/layout/AppSidebar.vue**
   - 使用 `openNewTab` 在新标签页打开文件管理器
   - 处理打开文件管理器事件
   - 管理SSH连接

4. **apps/desktop/src/router/index.ts**
   - 添加 `/file-manager` 路由
   - 支持通过URL参数传递连接信息

5. **apps/desktop/electron/ipc/ssh-handlers.ts**
   - 添加SFTP支持
   - 实现文件列表、上传、下载、删除等功能
   - 支持递归删除目录

6. **apps/desktop/electron/preload/index.ts**
   - 添加SFTP相关API
   - 添加文件对话框API

7. **apps/desktop/src/types/electron.d.ts**
   - 更新类型定义

## 使用方法

### 基本操作流程：

1. **打开文件管理器**
   ```
   右键SSH连接 -> 点击"文件管理" -> 自动连接并在新标签页打开
   注意：文件管理器在独立标签页中打开，可以同时管理多个连接的文件
   ```

2. **上传文件**
   ```
   点击"上传文件" -> 选择本地文件（可多选） -> 确认上传
   ```

3. **批量下载**
   ```
   勾选文件 -> 点击"批量下载" -> 选择保存目录 -> 自动下载
   ```

4. **文件操作**
   ```
   单个文件：鼠标悬停 -> 点击下载/删除按钮
   批量操作：勾选文件 -> 使用顶部批量操作按钮
   ```

5. **多标签管理**
   ```
   可以同时打开多个SSH连接的文件管理器
   每个文件管理器在独立的标签页中运行
   通过标签切换快速在不同服务器之间切换
   ```

## API 说明

### SSH SFTP 方法

- `ssh.listFiles(id, remotePath)` - 列出远程目录文件
- `ssh.uploadFile(id, localPath, remotePath)` - 上传文件
- `ssh.downloadFile(id, remotePath, localPath)` - 下载文件  
- `ssh.deleteFile(id, remotePath, isDirectory)` - 删除文件/目录
- `ssh.createDirectory(id, remotePath)` - 创建目录

### 文件系统方法

- `fs.showOpenDialog(options)` - 显示打开文件对话框
- `fs.showSaveDialog(options)` - 显示保存文件对话框

## 运行项目

重新构建并运行项目以应用更改：

```bash
# 进入桌面应用目录
cd apps/desktop

# 安装依赖（如需要）
npm install

# 构建并运行
npm run dev
```

## 注意事项

1. **类型检查**：如果 TypeScript 显示类型错误，请重启 IDE 或重新构建项目
2. **连接管理**：文件管理器会自动建立SSH连接，关闭标签页不会断开连接（因为可能还在使用终端）
3. **大文件传输**：支持进度显示，但建议分批上传/下载大文件
4. **权限问题**：确保SSH用户有足够权限访问和修改远程文件
5. **标签页模式**：文件管理器以标签页形式打开，与终端标签页并列，便于同时管理多个连接

## 后续优化建议

1. 添加拖拽上传功能
2. 支持文件重命名
3. 添加文件搜索功能
4. 支持文件预览
5. 添加传输队列管理
6. 支持断点续传

